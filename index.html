<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cotizador - Foto Shop Estudio</title>
<!--
  INSTRUCCIONES: Guarda este archivo y √°brelo en Chrome.
  Desde Monday.com, en la columna "Cotizar" pon links como:
  file:///ruta/Cotizador_FotoShopEstudio.html?from=monday&empresa=Raindoor&contacto=Sofia+Palma&email=sofia@raindoor.cl
  
  Par√°metros: empresa, contacto, email, telefono, cotizacion, descripcion, from=monday
-->
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--azul:#0099CC;--azul-dk:#007AA3;--negro:#1a1a1a;--g7:#374151;--g5:#6b7280;--g3:#d1d5db;--g1:#f3f4f6;--g0:#f9fafb;--blanco:#fff;--verde:#00c875;--rojo:#e2445c;--rad:10px;--sh:0 1px 3px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.04)}
body{font-family:'DM Sans',sans-serif;background:var(--g0);color:var(--negro);min-height:100vh}
.hdr{background:var(--blanco);border-bottom:1px solid var(--g3);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.hdr-l{display:flex;align-items:center;gap:16px}
.hdr-logo{font-size:20px;font-weight:700;color:var(--azul);letter-spacing:-.5px}
.hdr-logo span{color:var(--g5);font-weight:400;font-size:14px}
.hdr-t{font-size:15px;color:var(--g5);padding-left:16px;border-left:1px solid var(--g3)}
.btn{padding:8px 18px;border-radius:6px;font-family:inherit;font-size:13px;font-weight:500;cursor:pointer;border:none;transition:all .15s;display:inline-flex;align-items:center;gap:6px}
.bp{background:var(--azul);color:#fff}.bp:hover{background:var(--azul-dk);transform:translateY(-1px)}
.bs{background:var(--blanco);color:var(--g7);border:1px solid var(--g3)}.bs:hover{background:var(--g1)}
.bd{background:var(--rojo);color:#fff;font-size:11px;padding:4px 10px}
.bsm{padding:5px 12px;font-size:12px}
.ctn{max-width:1200px;margin:0 auto;padding:24px 32px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.card{background:var(--blanco);border-radius:var(--rad);border:1px solid var(--g3);overflow:hidden}
.ch{padding:14px 20px;border-bottom:1px solid var(--g1);display:flex;justify-content:space-between;align-items:center}
.ch h3{font-size:14px;font-weight:600}
.cb{padding:20px}
.fg{margin-bottom:14px}
.fg label{display:block;font-size:12px;font-weight:500;color:var(--g5);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.fg input,.fg textarea,.fg select{width:100%;padding:8px 12px;border:1px solid var(--g3);border-radius:6px;font-family:inherit;font-size:13px;color:var(--negro);transition:border-color .15s}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--azul);box-shadow:0 0 0 3px rgba(0,153,204,.1)}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.pf{background:rgba(0,153,204,.04);border-color:var(--azul)!important}
.pfb{display:inline-block;font-size:10px;background:var(--azul);color:#fff;padding:1px 6px;border-radius:3px;margin-left:6px;font-weight:400;text-transform:none;letter-spacing:0}
.ctabs{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.ctab{padding:5px 14px;border-radius:20px;font-size:12px;font-weight:500;cursor:pointer;border:1px solid var(--g3);background:var(--blanco);color:var(--g7);transition:all .15s}
.ctab:hover{border-color:var(--azul);color:var(--azul)}.ctab.active{background:var(--azul);color:#fff;border-color:var(--azul)}
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
.sc{border:1px solid var(--g3);border-radius:8px;padding:12px;cursor:pointer;transition:all .15s;position:relative}
.sc:hover{border-color:var(--azul);background:rgba(0,153,204,.02)}
.sc.sel{border-color:var(--azul);background:rgba(0,153,204,.05);box-shadow:0 0 0 2px rgba(0,153,204,.2)}
.sn{font-size:13px;font-weight:600;margin-bottom:2px}.sd{font-size:11px;color:var(--g5);margin-bottom:6px;line-height:1.3}
.sp{font-size:14px;font-weight:700;color:var(--azul)}.su{font-size:10px;color:var(--g5)}
.sbg{position:absolute;top:8px;right:8px;width:20px;height:20px;border-radius:50%;background:var(--azul);color:#fff;font-size:12px;display:none;align-items:center;justify-content:center}
.sc.sel .sbg{display:flex}
.it{width:100%;border-collapse:collapse;margin-top:12px}
.it th{text-align:left;font-size:11px;font-weight:600;color:var(--g5);text-transform:uppercase;letter-spacing:.5px;padding:8px 10px;border-bottom:2px solid var(--g1)}
.it td{padding:8px 10px;font-size:13px;border-bottom:1px solid var(--g1);vertical-align:middle}
.qi{width:60px;padding:4px 8px;border:1px solid var(--g3);border-radius:4px;font-size:13px;text-align:center;font-family:inherit}
.pi{width:90px;padding:4px 8px;border:1px solid var(--g3);border-radius:4px;font-size:13px;text-align:right;font-family:inherit}
.am{font-weight:600;text-align:right}
.tots{margin-top:16px;padding-top:12px;border-top:2px solid var(--g1);display:flex;flex-direction:column;align-items:flex-end;gap:6px}
.tr{display:flex;justify-content:space-between;width:250px;font-size:13px;color:var(--g7)}
.tr.fin{font-size:16px;font-weight:700;color:var(--negro);padding-top:6px;border-top:2px solid var(--azul)}
.lu{border:2px dashed var(--g3);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:all .15s}
.lu:hover{border-color:var(--azul)}.lu img{max-width:200px;max-height:80px;object-fit:contain}.lu p{font-size:12px;color:var(--g5);margin-top:8px}
.ni{display:flex;gap:8px;align-items:start;margin-bottom:6px}
.ni input{flex:1;padding:6px 10px;border:1px solid var(--g3);border-radius:4px;font-size:12px;font-family:inherit}
.sbar{padding:10px 32px;background:var(--g1);border-bottom:1px solid var(--g3);font-size:12px;color:var(--g5);display:flex;gap:20px;align-items:center}
.sbar .st{display:flex;align-items:center;gap:4px}.sbar .st strong{color:var(--negro)}
.pov{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:200;align-items:center;justify-content:center}
.pov.active{display:flex}
.pmod{background:#fff;border-radius:12px;width:90%;max-width:800px;max-height:90vh;overflow:auto;box-shadow:0 4px 24px rgba(0,0,0,.1)}
.pmh{padding:16px 24px;border-bottom:1px solid var(--g1);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:#fff;z-index:10}
.pmb{padding:24px}
.toast{position:fixed;bottom:24px;right:24px;background:var(--negro);color:#fff;padding:12px 20px;border-radius:8px;font-size:13px;box-shadow:0 4px 24px rgba(0,0,0,.1);transform:translateY(100px);opacity:0;transition:all .3s;z-index:300}
.toast.show{transform:translateY(0);opacity:1}
.mbadge{display:inline-flex;align-items:center;gap:6px;background:#FF3D57;color:#fff;padding:4px 12px;border-radius:4px;font-size:11px;font-weight:600}
</style>
</head>
<body>
<div class="hdr">
    <div class="hdr-l">
        <div class="hdr-logo">FOTO SHOP <span>ESTUDIO</span></div>
        <div class="hdr-t">Generador de Cotizaciones</div>
        <div id="msrc" style="display:none"><span class="mbadge">‚óè Desde Monday.com</span></div>
    </div>
    <div style="display:flex;gap:10px">
        <button class="btn bs" onclick="resetForm()">üóë Nueva</button>
        <button class="btn bs" onclick="preview()">üëÅ Vista Previa</button>
        <button class="btn bp" onclick="genPDF()">üìÑ Generar PDF</button>
    </div>
</div>
<div class="sbar">
    <div class="st">Servicios: <strong id="si">0</strong></div>
    <div class="st">Subtotal: <strong id="ss">$0</strong></div>
    <div class="st">Total c/IVA: <strong id="stt">$0</strong></div>
</div>
<div class="ctn">
    <div class="g2" style="margin-bottom:20px">
        <div class="card"><div class="ch"><h3>üìã Datos de la Cotizaci√≥n</h3></div><div class="cb">
            <div class="fr"><div class="fg"><label>N¬∫ Cotizaci√≥n</label><input id="nco"></div><div class="fg"><label>Estado</label><select id="est"><option value="PENDIENTE">Pendiente</option><option value="BORRADOR">Borrador</option><option value="ACEPTADA">Aceptada</option><option value="RECHAZADA">Rechazada</option></select></div></div>
            <div class="fr"><div class="fg"><label>Fecha Emisi√≥n</label><input type="date" id="fem"></div><div class="fg"><label>Fecha Vencimiento Pago</label><input type="date" id="fve"></div></div>
            <div class="fg"><label>Descripci√≥n / T√≠tulo</label><input id="desc" placeholder="Presupuesto Anual Cliente"></div>
            <div class="fg"><label>Sesi√≥n / Referencia</label><input id="ses" placeholder="SESION 15 DE MARZO 2026"></div>
        </div></div>
        <div class="card"><div class="ch"><h3>üë§ Datos del Cliente</h3></div><div class="cb">
            <div class="fg"><label>Empresa <span id="be" class="pfb" style="display:none">desde Monday</span></label><input id="cemp" placeholder="Nombre empresa"></div>
            <div class="fg"><label>Contacto <span id="bc" class="pfb" style="display:none">desde Monday</span></label><input id="ccon" placeholder="Nombre contacto"></div>
            <div class="fr"><div class="fg"><label>Tel√©fono</label><input id="ctel" placeholder="+56 9 1234 5678"></div><div class="fg"><label>Email</label><input id="cema" placeholder="contacto@empresa.cl"></div></div>
            <div class="fg" style="margin-top:12px"><label>Tu Logo (se guarda en tu navegador)</label>
                <div class="lu" onclick="document.getElementById('li').click()">
                    <div id="lp"><div style="font-size:28px;margin-bottom:4px">üñº</div><p>Click para subir logo (PNG/JPG)</p></div>
                    <input type="file" id="li" accept="image/*" style="display:none" onchange="hLogo(event)">
                </div>
            </div>
        </div></div>
    </div>
    <div class="card"><div class="ch"><h3>üì¶ Cat√°logo ‚Äî Click para agregar</h3><button class="btn bsm bs" onclick="addCust()">+ Manual</button></div><div class="cb">
        <div class="ctabs" id="ctabs">
            <div class="ctab active" onclick="fCat('all',this)">Todos</div>
            <div class="ctab" onclick="fCat('Fotograf√≠a',this)">üì∑ Fotograf√≠a</div>
            <div class="ctab" onclick="fCat('Producci√≥n',this)">üé¨ Producci√≥n</div>
            <div class="ctab" onclick="fCat('Post-Producci√≥n',this)">üñ• Post-Producci√≥n</div>
            <div class="ctab" onclick="fCat('Servicios Adicionales',this)">‚ûï Adicionales</div>
            <div class="ctab" onclick="fCat('Paquetes',this)">üì¶ Paquetes</div>
        </div>
        <div class="cgrid" id="cg"></div>
    </div></div>
    <div class="card" style="margin-top:20px"><div class="ch"><h3>üßæ Detalle</h3><span style="font-size:12px;color:var(--g5)" id="ic">0 items</span></div><div class="cb">
        <table class="it"><thead><tr><th style="width:22%">Producto</th><th style="width:28%">Descripci√≥n</th><th style="width:14%;text-align:right">Precio</th><th style="width:10%;text-align:center">Cant.</th><th style="width:14%;text-align:right">Importe</th><th style="width:8%"></th></tr></thead><tbody id="itb"><tr><td colspan="6" style="text-align:center;color:var(--g5);padding:30px">Selecciona servicios ‚òùÔ∏è</td></tr></tbody></table>
        <div class="tots" id="tsec" style="display:none">
            <div class="tr"><span>Subtotal (Neto)</span><span id="tsub">$0</span></div>
            <div class="tr"><span>IVA 19%</span><span id="tiva">$0</span></div>
            <div class="tr fin"><span>Total</span><span id="ttot">$0</span></div>
        </div>
    </div></div>
    <div class="card" style="margin-top:20px"><div class="ch"><h3>üìù Notas</h3><button class="btn bsm bs" onclick="addN()">+ Nota</button></div><div class="cb"><div id="nc">
        <div class="ni"><input value="El m√≠nimo por sesi√≥n son 45 SKU, en caso de tomar m√°s se ajustar√°n proporcionalmente." class="nin"><button class="btn bd" onclick="this.parentElement.remove()">‚úï</button></div>
        <div class="ni"><input value="Las prendas deben estar al menos 24 horas antes de la sesi√≥n en el estudio." class="nin"><button class="btn bd" onclick="this.parentElement.remove()">‚úï</button></div>
    </div></div></div>
    <div style="margin-top:24px;display:flex;gap:12px;justify-content:flex-end;padding-bottom:40px">
        <button class="btn bs" onclick="preview()">üëÅ Vista Previa</button>
        <button class="btn bp" onclick="genPDF()" style="padding:10px 28px;font-size:14px">üìÑ Generar PDF</button>
    </div>
</div>
<div class="pov" id="pov" onclick="if(event.target===this)clPrev()"><div class="pmod"><div class="pmh"><h3>Vista Previa</h3><div style="display:flex;gap:8px"><button class="btn bp" onclick="genPDF()">üìÑ PDF</button><button class="btn bs" onclick="clPrev()">‚úï</button></div></div><div class="pmb" id="pc"></div></div></div>
<div class="toast" id="toast"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script>
// === CAT√ÅLOGO ===
const CAT=[
{c:"FOTO-5V",n:"Fotos x 5 Vistas",d:"Fondo blanco con 5 vistas de tu producto",p:11500,u:"Por SKU",cat:"Fotograf√≠a"},
{c:"FOTO-3V",n:"Fotos x 3 Vistas",d:"Fondo blanco con 3 vistas",p:8500,u:"Por SKU",cat:"Fotograf√≠a"},
{c:"FOTO-COLG",n:"Foto Producto Colgado",d:"Producto colgado 1 vista",p:5500,u:"Por SKU",cat:"Fotograf√≠a"},
{c:"FOTO-360",n:"Foto 360¬∞",d:"Fotograf√≠a 360¬∞ de producto",p:15000,u:"Por SKU",cat:"Fotograf√≠a"},
{c:"FOTO-MOD",n:"Foto con Modelo",d:"Foto producto con modelo en estudio",p:18000,u:"Por SKU",cat:"Fotograf√≠a"},
{c:"PROD-MYP",n:"Maquillaje y Pelo",d:"Valor por Jornada por 1 modelo",p:70000,u:"Por Jornada",cat:"Producci√≥n"},
{c:"PROD-ASIS",n:"Asistente de Moda",d:"Asistente de moda en sesi√≥n",p:80000,u:"Por Jornada",cat:"Producci√≥n"},
{c:"PROD-PLAN",n:"Plancha",d:"Planchado prendas. 24hrs antes en estudio.",p:50000,u:"Por Jornada",cat:"Producci√≥n"},
{c:"PROD-CAT",n:"Catering",d:"Catering b√°sico ma√±ana + Almuerzo",p:20000,u:"Por Persona",cat:"Producci√≥n"},
{c:"POST-BAS",n:"Retoque B√°sico",d:"Recorte, color, fondo blanco",p:2000,u:"Por Foto",cat:"Post-Producci√≥n"},
{c:"POST-AVZ",n:"Retoque Avanzado",d:"Composici√≥n, sombras, limpieza",p:5000,u:"Por Foto",cat:"Post-Producci√≥n"},
{c:"SRV-CONS",n:"Consultor√≠a Visual",d:"Direcci√≥n visual para ecommerce",p:150000,u:"Por Sesi√≥n",cat:"Servicios Adicionales"},
{c:"SRV-INTL",n:"Internacionalizaci√≥n",d:"Adaptaci√≥n mercados internacionales",p:250000,u:"Por Proyecto",cat:"Servicios Adicionales"},
];

let items=[], logoURL=null;
const $=id=>document.getElementById(id);
const fCLP=n=>'$'+Math.round(n).toLocaleString('es-CL');
const fDate=s=>{if(!s)return'';const d=new Date(s+'T12:00:00');return d.getDate()+' '+['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'][d.getMonth()]+' '+d.getFullYear()};

// === INIT ===
document.addEventListener('DOMContentLoaded',()=>{
    const p=new URLSearchParams(location.search);
    $('nco').value=p.get('cotizacion')||'FSE'+(900+Math.floor(Math.random()*99));
    $('fem').value=new Date().toISOString().split('T')[0];
    const v=new Date();v.setDate(v.getDate()+30);$('fve').value=v.toISOString().split('T')[0];
    if(p.get('empresa')){$('cemp').value=p.get('empresa');$('cemp').classList.add('pf');$('be').style.display='inline'}
    if(p.get('contacto')){$('ccon').value=p.get('contacto');$('ccon').classList.add('pf');$('bc').style.display='inline'}
    if(p.get('email'))$('cema').value=p.get('email');
    if(p.get('telefono'))$('ctel').value=p.get('telefono');
    if(p.get('descripcion'))$('desc').value=p.get('descripcion');
    if(p.get('from')==='monday'){$('msrc').style.display='block';toast('Datos cargados de Monday: '+(p.get('empresa')||''))}
    try{const sl=localStorage.getItem('fse_logo');if(sl){logoURL=sl;$('lp').innerHTML=`<img src="${logoURL}" alt="Logo"><p>Click para cambiar</p>`}}catch(e){}
    rCat();
});

// === CAT√ÅLOGO ===
function rCat(f='all'){
    const g=$('cg'),fl=f==='all'?CAT:CAT.filter(s=>s.cat===f);
    g.innerHTML=fl.map(s=>`<div class="sc ${items.some(i=>i.c===s.c)?'sel':''}" onclick="tog('${s.c}')"><div class="sbg">‚úì</div><div class="sn">${s.n}</div><div class="sd">${s.d}</div><div class="sp">${fCLP(s.p)}</div><div class="su">${s.u}</div></div>`).join('');
}
function fCat(c,el){document.querySelectorAll('.ctab').forEach(t=>t.classList.remove('active'));el.classList.add('active');rCat(c)}
function gCF(){const a=document.querySelector('.ctab.active');return!a||a.textContent.includes('Todos')?'all':a.textContent.replace(/[üì∑üé¨üñ•‚ûïüì¶]/g,'').trim()}

// === ITEMS ===
function tog(cod){
    const i=items.findIndex(x=>x.c===cod);
    if(i>=0)items.splice(i,1);
    else{const s=CAT.find(x=>x.c===cod);if(s)items.push({...s,qty:1,px:s.p})}
    rItems();rCat(gCF());
}
function addCust(){items.push({c:'X'+Date.now(),n:'',d:'',p:0,px:0,qty:1,u:'',cat:'',cust:true});rItems()}

function rItems(){
    const tb=$('itb');
    if(!items.length){tb.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--g5);padding:30px">Selecciona servicios ‚òùÔ∏è</td></tr>';$('tsec').style.display='none';uSt();return}
    $('tsec').style.display='flex';
    tb.innerHTML=items.map((it,i)=>{
        const im=it.px*it.qty;
        const nm=it.cust?`<input type="text" value="${it.n}" onchange="items[${i}].n=this.value" style="width:100%;padding:4px 8px;border:1px solid var(--g3);border-radius:4px;font-size:13px" placeholder="Nombre">`:`<strong>${it.n}</strong>`;
        const ds=it.cust?`<input type="text" value="${it.d}" onchange="items[${i}].d=this.value" style="width:100%;padding:4px 8px;border:1px solid var(--g3);border-radius:4px;font-size:12px" placeholder="Descripci√≥n">`:`<span style="font-size:12px;color:var(--g5)">${it.d}</span>`;
        return `<tr><td>${nm}</td><td>${ds}</td><td style="text-align:right"><input class="pi" value="${it.px}" onchange="items[${i}].px=+this.value;rItems()"></td><td style="text-align:center"><input class="qi" value="${it.qty}" min="1" onchange="items[${i}].qty=+this.value||1;rItems()"></td><td class="am">${fCLP(im)}</td><td><button class="btn bd" onclick="items.splice(${i},1);rItems();rCat(gCF())">‚úï</button></td></tr>`;
    }).join('');
    uTot();uSt();$('ic').textContent=items.length+' items';
}

function getSub(){return items.reduce((s,i)=>s+i.px*i.qty,0)}
function uTot(){const s=getSub();$('tsub').textContent=fCLP(s);$('tiva').textContent=fCLP(s*.19);$('ttot').textContent=fCLP(s*1.19)}
function uSt(){const s=getSub();$('si').textContent=items.length;$('ss').textContent=fCLP(s);$('stt').textContent=fCLP(s*1.19)}

// === LOGO ===
function hLogo(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{logoURL=ev.target.result;try{localStorage.setItem('fse_logo',logoURL)}catch(e){}$('lp').innerHTML=`<img src="${logoURL}" alt="Logo"><p>Click para cambiar</p>`;toast('Logo guardado ‚úì')};r.readAsDataURL(f)}

// === NOTAS ===
function addN(){const d=document.createElement('div');d.className='ni';d.innerHTML='<input class="nin" placeholder="Escribe nota..."><button class="btn bd" onclick="this.parentElement.remove()">‚úï</button>';$('nc').appendChild(d)}
function gN(){return[...document.querySelectorAll('.nin')].map(i=>i.value).filter(v=>v.trim())}

// === PREVIEW ===
function preview(){
    const sub=getSub(),iva=sub*.19,tot=sub*1.19;
    const logo=logoURL?`<img src="${logoURL}" style="max-width:200px;max-height:90px;object-fit:contain">`:`<div style="font-size:32px;font-weight:800;color:#0099CC">FOTO SHOP<br><span style="font-size:16px;color:#555;font-weight:400;letter-spacing:4px">E S T U D I O</span></div>`;
    const rows=items.map(i=>`<tr><td style="padding:8px;font-weight:600;font-size:12px">${i.n}</td><td style="padding:8px;font-size:11px;color:#666">${i.d}</td><td style="padding:8px;text-align:right;font-size:12px">${fCLP(i.px)}</td><td style="padding:8px;text-align:center">${i.qty}</td><td style="padding:8px;text-align:center;font-size:11px;color:#666">19%(Excl.)</td><td style="padding:8px;text-align:right;font-weight:600">${fCLP(i.px*i.qty)}</td></tr>`).join('');
    const notas=gN().map(n=>`<div style="font-size:11px;color:#555;margin-bottom:3px">- ${n}</div>`).join('');
    $('pc').innerHTML=`<div style="font-family:Helvetica,sans-serif;color:#333;max-width:700px;margin:0 auto">
        <div style="text-align:right;font-size:12px;color:#888;margin-bottom:10px">${$('est').value}</div>
        ${logo}<hr style="border:none;border-top:2px solid #0099CC;margin:16px 0">
        <div style="display:flex;gap:24px"><div style="flex:1">
            <div style="font-size:24px;font-weight:700;margin-bottom:10px">Cotizaci√≥n</div>
            <div style="font-size:12px"><b>Cotizaci√≥n:</b> ${$('nco').value}</div>
            <div style="font-size:12px;margin-bottom:10px"><b>Emitida:</b> ${fDate($('fem').value)}</div>
            <div style="font-size:11px;font-weight:600;margin-bottom:4px">DE</div>
            <div style="font-size:12px">Foto Shop Estudio</div>
            <div style="font-size:11px;color:#666"><b>Tel:</b> +569 9330 6411</div>
            <div style="font-size:11px;color:#666"><b>Email:</b> max@fotoshopestudio.cl</div>
            <div style="font-size:11px;color:#666">Max Blanchard</div>
            <div style="font-size:11px;color:#666">La Puntilla 15740, Lo Barnechea</div>
        </div><div style="flex:1;border:1px solid #ddd;border-radius:6px;padding:14px">
            <div style="font-size:12px;font-weight:700;margin-bottom:6px">CLIENTE</div>
            <div style="font-size:13px;font-weight:600">${$('cemp').value||'‚Äî'}</div>
            <div style="font-size:12px;color:#666">${$('ccon').value}</div>
            <div style="font-size:11px;color:#666"><b>Tel:</b> ${$('ctel').value}</div>
            <div style="font-size:11px;color:#666"><b>Email:</b> ${$('cema').value}</div>
            <hr style="border:none;border-top:1px solid #eee;margin:8px 0">
            <div style="font-size:12px;color:#555">${$('desc').value}</div>
        </div></div>
        ${$('ses').value?`<div style="font-size:13px;font-weight:700;margin:18px 0 8px">${$('ses').value}</div>`:''}
        <table style="width:100%;border-collapse:collapse;margin-top:8px"><thead><tr style="background:#f5f5f5"><th style="text-align:left;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Producto</th><th style="text-align:left;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Descripci√≥n</th><th style="text-align:right;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Precio</th><th style="text-align:center;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Cant.</th><th style="text-align:center;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Imp.</th><th style="text-align:right;padding:8px;font-size:10px;text-transform:uppercase;color:#555">Importe</th></tr></thead><tbody>${rows}</tbody></table>
        <div style="display:flex;justify-content:flex-end;margin-top:12px"><div style="width:220px">
            <div style="display:flex;justify-content:space-between;font-size:12px;padding:4px 0"><span>Subtotal</span><span>${fCLP(sub)}</span></div>
            <div style="display:flex;justify-content:space-between;font-size:12px;padding:4px 0"><span>IVA 19%</span><span>${fCLP(iva)}</span></div>
            <div style="display:flex;justify-content:space-between;font-size:14px;font-weight:700;padding:6px 0;border-top:2px solid #0099CC;margin-top:4px"><span>Total</span><span>${fCLP(tot)}</span></div>
        </div></div>
        ${notas?`<div style="margin-top:18px"><div style="font-size:12px;font-weight:700;margin-bottom:6px">NOTAS</div>${notas}</div>`:''}
        ${$('fve').value?`<div style="margin-top:18px"><div style="font-size:12px;font-weight:700;margin-bottom:6px">PROGRAMACI√ìN DE PAGO</div><table style="width:100%;border-collapse:collapse"><tr style="background:#f5f5f5"><th style="text-align:left;padding:6px;font-size:10px">Vence</th><th style="text-align:left;padding:6px;font-size:10px">Importe</th></tr><tr><td style="padding:6px;font-size:12px">${fDate($('fve').value)}</td><td style="padding:6px;font-size:12px">${fCLP(tot)}</td></tr></table></div>`:''}
    </div>`;
    $('pov').classList.add('active');
}
function clPrev(){$('pov').classList.remove('active')}

// === PDF ===
function genPDF(){
    const{jsPDF}=window.jspdf,doc=new jsPDF('p','mm','letter');
    const pW=doc.internal.pageSize.getWidth(),m=18,cW=pW-m*2;
    let y=15;const nc=$('nco').value||'FSE000';
    
    doc.setFontSize(10);doc.setTextColor(150);doc.text($('est').value,pW-m,y,{align:'right'});
    
    if(logoURL){try{doc.addImage(logoURL,'PNG',m,y,50,25);y+=30}catch(e){tLogo()}}else{tLogo()}
    function tLogo(){doc.setFontSize(24);doc.setTextColor(0,153,204);doc.setFont('helvetica','bold');doc.text('FOTO SHOP',m,y+8);doc.setFontSize(12);doc.setTextColor(100);doc.setFont('helvetica','normal');doc.text('E S T U D I O',m,y+16);y+=22}
    
    doc.setDrawColor(0,153,204);doc.setLineWidth(.8);doc.line(m,y,pW-m,y);y+=10;
    doc.setFontSize(22);doc.setTextColor(30);doc.setFont('helvetica','bold');doc.text('Cotizaci√≥n',m,y);y+=8;
    doc.setFontSize(9);doc.setFont('helvetica','normal');doc.setTextColor(80);
    doc.text('Cotizaci√≥n: '+nc,m,y);y+=4;doc.text('Emitida el: '+fDate($('fem').value),m,y);y+=6;
    doc.setFont('helvetica','bold');doc.text('DE',m,y);y+=4;doc.setFont('helvetica','normal');
    doc.text('Foto Shop Estudio',m,y);y+=4;doc.text('Tel√©fono: +569 9330 6411',m,y);y+=4;
    doc.text('Email: max@fotoshopestudio.cl',m,y);y+=4;doc.text('Empresa: Max Blanchard',m,y);y+=4;
    doc.text('La Puntilla 15740, Lo Barnechea',m,y);y+=4;doc.text('Regi√≥n Metropolitana, Chile',m,y);
    
    const cx=pW/2+5,cy0=y-36,cw=cW/2-5;
    doc.setDrawColor(200);doc.setLineWidth(.3);doc.rect(cx,cy0-4,cw,44);
    let cy=cy0;doc.setFont('helvetica','bold');doc.setFontSize(9);doc.setTextColor(30);
    doc.text('CLIENTE',cx+4,cy);cy+=5;doc.setFontSize(10);doc.text($('cemp').value||'‚Äî',cx+4,cy);cy+=4;
    doc.setFont('helvetica','normal');doc.setFontSize(9);doc.setTextColor(80);
    doc.text($('ccon').value||'',cx+4,cy);cy+=4;doc.text('Tel: '+($('ctel').value||''),cx+4,cy);cy+=4;
    doc.text('Email: '+($('cema').value||''),cx+4,cy);cy+=6;
    doc.setDrawColor(230);doc.line(cx+4,cy-2,cx+cw-4,cy-2);doc.text($('desc').value||'',cx+4,cy+2);
    y+=12;
    
    if($('ses').value){doc.setFont('helvetica','bold');doc.setFontSize(10);doc.setTextColor(30);doc.text($('ses').value,m,y);y+=8}
    
    const td=items.map(i=>[i.n,i.d,fCLP(i.px),String(i.qty),'19% (Excl.)',fCLP(i.px*i.qty)]);
    if(td.length){
        doc.autoTable({startY:y,head:[['Producto','Descripci√≥n','Precio','Cant.','Imp.','Importe']],body:td,margin:{left:m,right:m},
            styles:{fontSize:8,textColor:[80,80,80],cellPadding:3,font:'helvetica'},
            headStyles:{fillColor:[245,245,245],textColor:[50,50,50],fontStyle:'bold',fontSize:7.5},
            columnStyles:{0:{fontStyle:'bold',textColor:[30,30,30],cellWidth:cW*.18},1:{cellWidth:cW*.28},2:{halign:'right',cellWidth:cW*.14},3:{halign:'center',cellWidth:cW*.08},4:{halign:'center',cellWidth:cW*.12},5:{halign:'right',fontStyle:'bold',cellWidth:cW*.14}},
            alternateRowStyles:{fillColor:[252,252,252]}});
        y=doc.lastAutoTable.finalY+4;
    }
    
    const sub=getSub(),iva=sub*.19,tot=sub*1.19,tx=pW-m-55;
    doc.setFontSize(9);doc.setFont('helvetica','normal');doc.setTextColor(80);
    doc.text('Subtotal',tx,y);doc.text(fCLP(sub),pW-m,y,{align:'right'});y+=5;
    doc.text('IVA - 19%',tx,y);doc.text(fCLP(iva),pW-m,y,{align:'right'});y+=3;
    doc.setDrawColor(0,153,204);doc.setLineWidth(.6);doc.line(tx,y,pW-m,y);y+=5;
    doc.setFont('helvetica','bold');doc.setFontSize(11);doc.setTextColor(30);
    doc.text('Total',tx,y);doc.text(fCLP(tot),pW-m,y,{align:'right'});y+=12;
    
    const notas=gN();
    if(notas.length){if(y>230){doc.addPage();y=20}doc.setFont('helvetica','bold');doc.setFontSize(10);doc.setTextColor(30);doc.text('NOTAS',m,y);y+=6;doc.setFont('helvetica','normal');doc.setFontSize(8);doc.setTextColor(100);notas.forEach(n=>{if(y>250){doc.addPage();y=20}const l=doc.splitTextToSize('- '+n,cW);doc.text(l,m,y);y+=l.length*4+2})}
    
    if($('fve').value){if(y>240){doc.addPage();y=20}y+=4;doc.setFont('helvetica','bold');doc.setFontSize(10);doc.setTextColor(30);doc.text('PROGRAMACI√ìN DE PAGO',m,y);y+=6;doc.autoTable({startY:y,head:[['Vence el','Importe']],body:[[fDate($('fve').value),fCLP(tot)]],margin:{left:m,right:m},styles:{fontSize:9,font:'helvetica'},headStyles:{fillColor:[245,245,245],textColor:[50,50,50],fontStyle:'bold',fontSize:8}})}
    
    doc.save('Cotizacion-'+nc+'.pdf');toast('PDF generado: Cotizacion-'+nc+'.pdf ‚úì');
}

// === RESET & TOAST ===
function resetForm(){if(!confirm('¬øBorrar todo?'))return;items=[];$('nco').value='FSE'+(900+Math.floor(Math.random()*99));['cemp','ccon','ctel','cema','desc','ses'].forEach(id=>$(id).value='');$('est').value='PENDIENTE';$('fem').value=new Date().toISOString().split('T')[0];document.querySelectorAll('.pf').forEach(e=>e.classList.remove('pf'));document.querySelectorAll('.pfb').forEach(e=>e.style.display='none');rItems();rCat();toast('Limpio ‚úì')}
function toast(m){const t=$('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000)}
</script>
</body>
</html>
